# 座號評價查詢系統

一個用於查詢座號評價的網頁應用程式，支援 **PWA（Progressive Web App）** 技術，可安裝至手機與電腦桌面！

## 功能特色

- 🔍 **評價查詢**：輸入座號 (25-46) 查看個人評價
- 📊 **排行榜**：顯示最高和最低評價的前三名
- 🔒 **銳評保護**：需要密碼才能查看銳評內容
- 🔑 **多次查詢**：輸入查詢密碼可多次查詢評價
- ⏰ **查詢限制**：首次查詢免密碼，之後需要查詢密碼
- 🔐 **管理員功能**：生成和管理查看密碼與查詢密碼
- 📱 **PWA 支援**：可安裝到手機/電腦桌面，支援離線使用
- 🚀 **快速存取**：安裝後可從主畫面直接開啟，無需瀏覽器

## 📱 安裝到手機/桌面

### Android 裝置
1. 使用 Chrome 或 Edge 瀏覽器開啟網站
2. 點擊畫面下方的「安裝」按鈕，或
3. 點擊瀏覽器選單 (⋮) → 「安裝應用程式」或「加到主畫面」
4. 確認安裝後，應用程式圖示會出現在主畫面

### iOS 裝置 (iPhone/iPad)
1. 使用 Safari 瀏覽器開啟網站
2. 點擊底部分享按鈕 (□↑)
3. 向下滾動並選擇「加入主畫面螢幕」
4. 點擊「加入」確認

### 桌面電腦 (Windows/Mac/Linux)
1. 使用 Chrome、Edge 或其他支援 PWA 的瀏覽器開啟網站
2. 點擊網址列右側的安裝圖示 (⊕)，或
3. 點擊畫面下方的「安裝」按鈕
4. 確認安裝後，應用程式會出現在應用程式列表中

### 離線功能
- 安裝後，應用程式會自動快取資料
- 即使沒有網路連線，也能查看已快取的內容
- 重新連線後會自動同步最新資料

## 評價系統

評價分為四個等級（由高到低）：
- **L** (3分) - 最高評價
- **S** (2分) - 優秀
- **A** (1分) - 良好
- **X** (0分) - 需改進

系統會自動計算所有評價者的平均分數，並轉換為對應的等級。

## 使用方法

### 一般使用者

1. 開啟 `index.html`
2. 輸入座號 (25-46)
3. 點擊「查詢評價」查看評價結果（首次查詢免密碼）
4. 如需再次查詢，輸入管理員提供的查詢密碼
5. 如需查看銳評，輸入管理員提供的銳評密碼

**注意**：首次查詢免密碼，之後需要查詢密碼才能多次查詢！

### 管理員

1. 開啟 `admin.html`
2. 輸入管理員密碼：``
3. 設定或生成兩種密碼：
   - **銳評密碼**：用於查看銳評內容
   - **查詢密碼**：用於允許多次查詢評價
4. 系統會自動下載更新後的 `data.csv` 檔案
5. 將下載的 `data.csv` 檔案替換原有的檔案
6. 密碼會在所有裝置上同步生效
7. 將對應的密碼分享給需要的使用者

## 檔案說明

### 核心檔案
- `index.html` - 主頁面，用於查詢評價
- `admin.html` - 管理員頁面，用於管理密碼
- `comment-editor.html` - 銳評編輯頁面（支援多人同時編輯）
- `data.csv` - 系統使用的評價資料檔案
- `auth.js` - 身份驗證相關功能

### PWA 相關檔案
- `manifest.json` - Web App 資訊清單，定義應用程式名稱、圖示等
- `sw.js` - Service Worker，提供離線功能和快取管理
- `icon-192.png` - 應用程式圖示 (192x192)
- `icon-512.png` - 應用程式圖示 (512x512)

### 其他頁面
- `comments/` - 存放銳評檔案的目錄
  - `manifest.json` - 記錄要載入的銳評檔案清單
  - `editor_{座號}_{時間戳}.csv` - 個別編輯者提交的銳評檔案
  - `README.md` - 銳評系統說明文件

## 資料格式

### `Ranking.xlsx` 格式（資料來源）：
- 第 1 行：標題行（評價者, 評價者座號1, 評價者座號2, ..., 銳評）
- 第 2-23 行：座號 25-46 的評分數據，每行包含：
  - 第 1 列：座號（25-46）
  - 第 2-N 列：來自各評價者的評分 (0=X, 1=A, 2=S, 3=L)
  - 最後一列：該座號的銳評內容
- 最後一行：密碼行（密碼, PASSWORD_VALUE）

### `data.csv` 格式（系統使用）：
- 第一行：標題行（評價者, 評價者座號1, 評價者座號2, ...）例如：評價者,19,18,14,1,5,10,21,3,7,6,20,13
- 第 2-23 行：各座號（25-46）的評分數據，每行包含：
  - 第 1 列：座號（25-46）
  - 第 2-N 列：來自各評價者的評分 (0=X, 1=A, 2=S, 3=L)
- 倒數第二行：銳評內容（銳評,comment1,comment2,...）
- 最後一行：密碼（密碼,銳評密碼,查詢密碼）

## 資料更新流程

### 銳評編輯流程（支援多人同時編輯）

1. 使用銳評編輯器 (`comment-editor.html`) 輸入管理員提供的啟用碼
2. 編輯銳評內容
3. 提交後會下載 `editor_{座號}_{時間戳}.csv` 檔案
4. 將下載的檔案加入到 `comments/` 目錄
5. 編輯 `comments/manifest.json`，將檔案名稱加入 `comment_files` 陣列
6. 提交兩個檔案到 repository（CSV 檔案 + manifest.json）

**優點**：多位編輯者可以同時提交不同的銳評檔案，不會產生衝突。系統會自動合併所有銳評。

### 評分資料更新流程

**注意**：評分資料存儲在 `data.csv` 檔案中。如需更新評分，請直接編輯 `data.csv` 檔案。

1. 直接編輯 `data.csv` 檔案更新評分
2. 確保格式符合上述 `data.csv` 格式說明
3. 網頁會自動使用更新後的資料

**關於 convert_xlsx_to_csv.py**：此腳本會產生不同格式的 CSV 檔案，目前與系統使用的格式不相容。如需使用 Excel 管理資料，請依照現有 `data.csv` 的格式創建 Excel 檔案。

## 技術特點

- 純 HTML/CSS/JavaScript，無需伺服器
- **Progressive Web App (PWA)**：可安裝到裝置，支援離線使用
- **Service Worker**：自動快取資源，提升載入速度
- 密碼儲存於 CSV 檔案，支援跨裝置同步
- 使用 localStorage 儲存查詢記錄和通行碼
- 響應式設計，支援行動裝置
- 美觀的漸層色彩設計
- **支援多人同時編輯銳評**：使用獨立檔案系統，避免編輯衝突
- 自動合併多個銳評來源
- 安裝橫幅提示，引導使用者安裝應用程式

## 本地運行

直接用瀏覽器開啟 `index.html` 即可使用。

**建議使用本地伺服器**以獲得完整的 PWA 功能（Service Worker 需要 HTTPS 或 localhost）：

```bash
# Python 3
python -m http.server 8000

# 或使用 Node.js http-server
npx http-server
```

然後在瀏覽器中訪問 `http://localhost:8000`

### PWA 測試
- 在本地測試時，Service Worker 可以在 `localhost` 上運作
- 部署到正式環境時，必須使用 HTTPS
- 使用 Chrome DevTools 的 Application 標籤可以檢查 PWA 狀態
